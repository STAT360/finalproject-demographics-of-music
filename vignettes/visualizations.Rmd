---
title: "visualizations"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{data_wrangling}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

```{r setup}
library(musicDemographicsPackage)
library(gdata)
library(dplyr)
library(tidyr)
library(ggplot2)
library(forcats)
library(cowplot)
library(viridis)
library(devtools)
```

This is the same graph as the [website](statista.com). 
It shows the total percentage of favorite music genres by age group. 
```{r}
# Data 1 Graph 1
genres_by_age_2018 %>% ggplot() + 
  geom_bar(mapping = aes(x=genre, y=percent_response, fill=age_range), stat="identity", color="white") +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))+
  labs(x = "Genres", y = "% Response") + 
  guides(fill=guide_legend(title="Age Ranges"))+
  ggtitle("Age Grouped Preference for Music Genres Among Consumers in the\n United States as of July 2018") +
  theme(plot.title = element_text(hjust = 0.5))
```

We thought that the graph that was on the website where we got the data from was a little messy and hard to understand, so we made a couple new graphs that we though better represented it. Data 1 Graph 2, shows the same data as Data 1 Graph 1, but separated into graphs based on Genre, with each color representing a different age group.
```{r}
# Data 1 Graph 2
p <- genres_by_age_2018 %>% ggplot() + 
  geom_bar(mapping = aes(x=genre, y=percent_response, fill = genre), stat="identity") +
  facet_wrap(vars(age_range), scales = "free_x") +
  theme(axis.text.x = element_text(angle = 90, hjust = 1)) +
  guides(fill=guide_legend(title="Genres")) + 
  ggtitle("Age Group Genre Preferences in the United States\n as of July 2018") +
  labs(x = "", y = "% Response") +
  theme(plot.title = element_text(hjust = 0.5))+
  theme(axis.text.x = element_blank())
p
```

This it the third graph for the first data set in this package. It is similar to the Data 1 Graph 2, except that it is now separated into graphs based on age group. Each color represents a different genre.
```{r}
# Data 1 Graph 3
p <- genres_by_age_2018 %>% ggplot() + 
  geom_bar(mapping = aes(x=age_range, y=percent_response, fill = age_range), stat="identity") +
  facet_wrap(vars(genre), scales = "free_x") +
  theme(axis.text.x = element_text(angle = 90, hjust = 1)) +
  guides(fill=guide_legend(title="Age Ranges")) + 
  ggtitle("Music Genre Preferences by Age in the United States\n as of July 2018") +
  labs(x = "", y = "% Response") +
  theme(plot.title = element_text(hjust = 0.5))+
  theme(axis.text.x = element_blank())
p
```

This graph is our replica of the graph found on the website that we found our data from (https://www.statista.com/statistics/749666/music-listening-habits-age-usa/). It shows the Music listening frequency in the United States as of Agust 2017, by age.
```{r}
# Data 2 Graph 1
listening_frequency_by_age_2017 %>% 
  mutate(Frequency = fct_relevel(Frequency, "Everyday", "4-6 per week", "1-3 per week", "Few Times a Month", "Monthly or Less", "Never")) %>% 
  mutate(Generation = fct_relevel(Generation, "Gen Z (18-24)", "Millennial (25-34)", "35 and older", "Total USA")) %>% 
  ggplot() + 
  geom_bar(mapping = aes(x=Frequency, y=number, fill = Frequency), stat="identity") +
  facet_grid(cols=vars(Generation))+
  theme(axis.text.x = element_blank())+
  labs(x = "", y = "% Response") +
  guides(fill=guide_legend(title="Frequencies")) + 
  ggtitle("Age Range Music Listening Frequencies in the United States\n as of August 2017") +
  theme(plot.title = element_text(hjust = 0.5))

```

This graph is a replica of the graph found on the website where we got the data from (https://www.statista.com/statistics/864622/music-genre-diversity/). It shows the public opinion on the racial diversity of selected music genres in the United States as of May 2018.
```{r}
# Data 3 Graph 1
racially_diverse_music_2018 %>% ggplot() + 
  geom_bar(mapping = aes(x=genre, y=percent_response), stat="identity", color="white", fill="blue") +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))+
  labs(x = "Genres", y = "% Response") + 
  ggtitle("Percent of People who Think a Genre is Racially Diverse\n in the United States as of May 2018") +
  theme(plot.title = element_text(hjust = 0.5))+
  coord_flip()
```
```{r}
# Data 3 Graph 2
racially_diverse_music_2018 %>% ggplot() + 
  geom_bar(mapping = aes(x=genre, y=percent_response), stat="identity", color="white", fill="blue") +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))+
  labs(x = "Genres", y = "% Response") + 
  ggtitle("Percent of People who Think a Genre is Racially Diverse\n in the United States as of May 2018") +
  theme(plot.title = element_text(hjust = 0.5))
```

```{r}
# Data 3 Graph 3
racially_diverse_music_2018 %>% ggplot() + 
  geom_bar(mapping = aes(x = reorder(genre, -percent_response), y=percent_response), stat="identity", color="white", fill="blue") +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))+
  labs(x = "Genres", y = "% Response") + 
  ggtitle("Percent of People who Think a Genre is Racially Diverse\n in the United States as of May 2018") +
  theme(plot.title = element_text(hjust = 0.5))
```


```{r}
# Combine Data 1 & 3
#genres <- racially_diverse_music_2018_mod$genre
#plots <- plot.new()
#loop.vector <- 1:10

#for( str_genre in genres){
  #New data after join 
  preference_g <- combined_data %>% filter(genre == "Classic Rock") %>% ggplot() + 
    geom_bar(mapping = aes(x=age_range, y=percent_response, fill = age_range), stat="identity") +
    theme(axis.text.x = element_text(angle = 90, hjust = 1)) +
    guides(fill=guide_legend(title="Age Range")) +
    labs(x = "Age Range", y = "% Response") +
    theme(plot.title = element_text(hjust = 0.5))+
    theme(axis.text.x = element_blank()) +
    coord_cartesian(ylim = c(0,100)) +
    theme(legend.position = "none") 
  #preference_g
  
  diversity_g <- racially_diverse_music_2018_mod %>% filter(genre == "Classic Rock") %>% ggplot() + 
    geom_bar(mapping = aes(x = genre, y=avg_response), stat="identity", color="white", fill="blue") +
    theme(axis.text.x = element_text(angle = 45, hjust = 1))+
    labs(x = "Diversity", y = "") +
    theme(axis.text.x = element_blank())+
    theme(axis.text.y = element_blank())+
    coord_cartesian(ylim = c(0,100)) 
    
  #diversity_g
  preference_g
  
  #plots <- c(plots, 
  plot <- ggdraw() +
  draw_plot(preference_g + theme(legend.justification = "bottom"), 0, 0, .8, 1) +
  draw_plot(diversity_g, 0.75, 0, .2, 1) +
  draw_plot_label(c("%", ""), c(0, 0.8), c(1, 0.95), size = 15)
  plot
#}
#plots

#plot_grid(preference_g, diversity_g, labels = c("A", "B"), align = "h") 

#Genre Preference \n and Perception of Genre Diversity by Age")

#classic_rock = preference_g %>% filter(genre == "Classic Rock")
```
